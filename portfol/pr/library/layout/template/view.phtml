<?
/*
// Напутствие потомкам (присно следовать да блюсти строжайше): ручная
// правка автоматически сгенерированного кода не доведёт до добра. Коли
// вас, несчастных, не пущают к генератору, или же
// история не сохранила и руин оного, то ничего вам не остаётся, кроме
// как главою бить о сруб светлицы да отраву пить. Сочувствую, коли
// вам выпала сия доля, но чем-либо облегчить вашу участь не в моей
// власти. Да пребудет с вами сила.
*/
?>

    <!-- Add mousewheel plugin (this is optional) -->
    <script type="text/javascript" src="/fancybox/lib/jquery.mousewheel-3.0.6.pack.js"></script>
    <!-- Add fancyBox -->
    <link rel="stylesheet" href="/fancybox/source/jquery.fancybox.css?v=2.1.5" type="text/css" media="screen" />
    <script type="text/javascript" src="/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
    <div class="forms">
        <h3 class="formh"></h3>
        <form class="form-horizontal" enctype="multipart/form-data" class="form-entity-save"<?if(!defined('READ_ONLY_MODE')) {?> method="POST" action="/index/save/" <? } ?>>
            <?if(!defined('READ_ONLY_MODE')) {?>
                <input type="hidden" name="q" value="<?=$this->data->q?>" />
                <input type="hidden" name="form[home_id]" value="<?=$this->home_id?>" />
                <input type="hidden" name="form[id]" class="input_form_id" <?if($this->data->values && property_exists($this->data->values, 'id')){?>value="<?=$this->data->values->id?>"<?}?> />
            <?}?>
            {$fields_without_group}
            {$save}
        </form>
        {$inner_tables}
        {$groups}
    </div>

<!-- delete record ajax-form -->

    <form class="popup-form popup-ajax" action="/index/deleterecord/" id="form-deleterecord" title="Удаление записи" method="POST">
        <input type="hidden" name="form[q]" id="deleterecord-q" />
        <input type="hidden" name="form[id]" id="deleterecord-id" />
    </form>

    <script>

        var del_table_code = '';

        $(function(){
            $('#form-deleterecord').data('success', function(data) {
                $('#row_' + del_table_code + '_' + data.id).remove();
                hide_form();
                try {
                    $('.circle').text(data.resp.fill + '%');
                    redrawAngles();
                } catch (e) {
                    // do nothing
                }
            });
        });

        function deleteRecord(code, q, record_id) {
            if(!confirm('Вы действительно хотите удалить запись?')) {
                return false;
            }
            del_table_code = code;
            $('#deleterecord-q').val(q);
            $('#deleterecord-id').val(record_id);
            return $('#form-deleterecord').submit();
        }

    </script>

<!-- delete file ajax-form -->

	<form class="popup-form popup-ajax" action="/index/deletefile/" id="form-deletefile" title="Удаление файла" method="POST">
        <input type="hidden" name="form[filename]" id="deletefile-name" />
        <input type="hidden" name="form[code]" id="deletefile-code" />
        <input type="hidden" name="form[q]" id="deletefile-q" value="<?= $this->data->q ?>" />
        <input type="hidden" name="form[home_id]" value="<?= $this->home_id ?>" />
    </form>

    <script>
        $(function(){
            $('#form-deletefile').data('success', function(data) {
                $('#' + data.hash).remove();
                hide_form()
            });
        });

        function deleteFile(filepath, code) {
            if(!confirm('Вы действительно хотите удалить приложенный файл?')) {
                return false;
            }
            $('#deletefile-name').val(filepath);
            $('#deletefile-code').val(code);
            $('#form-deletefile').submit();
            return false;
        }
    </script>

<!-- / -->
