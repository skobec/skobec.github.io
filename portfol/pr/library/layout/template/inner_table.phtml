<div class="inner-table">
    <span class="inner-table-head">{$inner_table_name}</span>
    <table class="table-inner-box">
    <tr>
    <td>
        <table class="table table-inner">
            <thead>
                <tr>
                    <?foreach($this->data->table_fields->{$code} as $field){?>
                        <th><?=htmlspecialchars($field->title)?></th>
                    <?}?>
                    <?if(!defined('READ_ONLY_MODE')) {?>
                        <th></th>
                    <?}?>
                </tr>
            </thead>
            <tbody>
                <?if(count($this->data->table_values->{$code})){?>
                    <?foreach($this->data->table_values->{$code} as $row){$row=(array)$row;?>
                        <tr id="row_{$code}_<?=$row['id']?>">
                            <?foreach($this->data->table_fields->{$code} as $field){?>
                                <?if($field->type == 8) {//file?>
                                    <?$paths = explode('|', $row[$field->code]);?>
                                    <td>
                                        <?foreach($paths as $file_path){if(!$file_path){continue;}?>
                                            <?$title = explode('/', $file_path); $title = array_pop($title);?>
                                            <a href="<?=htmlspecialchars($file_path)?>" class="home-file"><img src="/img/icon-file.png" alt="file" align="absmiddle" /><?=htmlspecialchars($title)?></a>
                                        <?}?>
                                    </td>
                                <?}elseif($field->type == Engine::TYPE_BOOL){?>
                                    <td><?=htmlspecialchars($row[$field->code] == 1 ? 'Да' : 'Нет')?></td>
                                <?}elseif($field->type == Engine::TYPE_DATE){?>
                                    <td><?=Format::date(strtotime($row[$field->code]), true, false, false, false, false)?></td>
                                <?}elseif($field->type == Engine::TYPE_ENTITY){?>
                                    <?$dic_title = null;$field_code = $field->code;?>
                                    <?foreach($this->data->entity_fields->$field_code as $dic_item){
                                        if($dic_item->id == $row[$field->code]) {
                                            $dic_title = $dic_item->title;
                                        }
                                    }?>
                                    <td><?=htmlspecialchars($dic_title)?></td>
                                <?}else{?>
                                    <td><?=htmlspecialchars($row[$field->code])?></td>
                                <?}?>
                            <?}?>
                            <?if(!defined('READ_ONLY_MODE')) {?>
                            <td style="width: 1%;"><a href="#" onclick="return deleteRecord('{$code}', '<?=$this->data->table_q->{$code}?>', <?=$row['id']?>);"><i class="icon-remove"></i></a></td>
                            <?}?>
                        </tr>
                    <?}?>
                <?}else{?>
                    <tr>
                        <td colspan="<?=count((array)$this->data->table_fields->{$code}) + (defined('READ_ONLY_MODE') ? 0 : 1)?>"><span class="font-no-data">записей нет</span></td>
                    </tr>
                <?}?>
            </tbody>
        </table>
        <? if(!defined('READ_ONLY_MODE')) { ?>
        <a class="btn btn-primary save-table-inner" href="#" onclick="return showAddInnerTable('{$code}', {q: '<?=$this->data->table_q->{$code}?>', 'home_id': <?=(int)$this->home_id?>});"><i class="icon-plus icon-white"></i> Добавить...</a>
        <? } ?>
    </td>
    </tr>
    </table>
    {$table_row_template}
</div>